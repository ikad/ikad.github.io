<!DOCTYPE html>
<html>
<head>
  <title></title>
</head>
<body>
  <h1>Hello</h1>

  <form id="post-form">
    <input name="authenticity_token" id="csrf-token" type="hidden">
    <input name="post[title]">
    <input type="submit">
  </form>

  <div id="posts"></div>

  <script>
    // var host = "//localhost:3000";
    var host = "//ikad-api-sample.herokuapp.com";

    var xhr = new XMLHttpRequest();
    xhr.open("GET", host + "/api/posts", true);
    xhr.withCredentials = true;
    xhr.onload = function() {
      var posts_elm = document.getElementById("posts");
      var json = JSON.parse(xhr.responseText);
      for (var i=0;i<json.length;i++) {
        var p_elm = document.createElement("p");
        p_elm.innerHTML = json[i].title;
        posts_elm.appendChild(p_elm);
      }
    }
    xhr.send(null);

    var form_elm = document.getElementById("post-form");
    form_elm.onsubmit = function(e) {
      e.preventDefault();

      var xhr2 = new XMLHttpRequest();
      xhr2.open("GET", host + "/api/posts/new", true);
      xhr2.withCredentials = true;
      xhr2.onload = function() {
        sendPost(JSON.parse(xhr2.responseText).token);
      }
      xhr2.send(null);
    }

    function sendPost(token) {
      var xhr3 = new XMLHttpRequest();
      xhr3.open("POST", host + "/api/posts", true);
      xhr3.setRequestHeaders('X-CSRF-Token', token);
      xhr3.withCredentials = true;
      xhr3.send(new FormData(form_elm));
    }
  </script>
</body>
</html>
